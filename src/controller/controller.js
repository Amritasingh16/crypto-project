const { default: axios } = require('axios');
const blockModel = require('../model/blockModel');

const getBlock =  async function(req, res){
 try{

    let options = {
       headers: {Authorization:"Bearer 4a224fb3-4e2d-4483-944d-c602c49289e7"},
       method: "get",
       url: `https://api.coincap.io/v2/assets`
    }
    let result = await axios(options)
    console.log(result)
    let data = result.data.data
   const sortdata = data.sort((a, b) => { return a.changePercent24Hr - b.changePercent24Hr }); 
        
    await blockModel.deleteMany() 

    let block = await blockModel.create(sortdata)

    let finalBlocks = await blockModel.find().select({__v:0, _id:0}) 

    return res.status(201).send({staus:true, message:"Blocks successfully created", data:finalBlocks})

 }catch(error){
    return res.status(500).send({status:false, message: error.message})

 }
}
module.exports.getBlock = getBlock




















































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































// const model= require("../model/model")
// const axios= require("axios")

// const getBitCoin= async function(req,res){
//     const headers= req.headers.authorization
//     const coinData= await axios.get(`https://api.coincap.io/v2/assets`)
//     const data= coinData.data.data
//     let{symbol, name, marketCapUsd , priceUsd, changePercent24Hr}= data
    
//     const result= await model.find({symbol:symbol,name:name,marketCapUsd:marketCapUsd,priceUsd:priceUsd})
//     if(result){
//         return res.status(200).send({ status: true, data: "Already Exist" })  
//     }
//     const finalResult= await model.create(data)
//     res.send({ status: true, data: symbol,name,marketCapUsd,priceUsd,changePercent24Hr})

// }


// module.exports.getBitCoin=getBitCoin



